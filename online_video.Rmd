---
title: "Online video for direct services: who can we reach?"
output: html_document
---

**1. Motivation**

Online video has taken off in many sectors. Education is a primary example: companies such as Coursera, Lynda.com and Udemy all use online video to deliver lectures and tutorials to large numbers of learners. It's not difficult to see the value in building products around online video: users have easy and flexible access to an engaging learning experience, and once this content has been through production, it can be delivered to a large and geographically-dispersed audience.

The growth of online video suggests a use case for organizations providing direct services to the public, such as local government agencies or legal self-help programs. These organizations often need to offer generic information and guidance at scale, but text-based content remains the default mode of communication. Could online video provide a more engaging and effective method of communicating for these services? 

In considering the potential for online video in direct services, it's important to develop a baseline understanding of its demographic reach as a channel. This leads to two questions that are the focus of this blog:

1. *Depth of reach:* what fraction of the US population watches online video?  
2. *Breadth of reach:* how does consumption of online video vary across demographic groups?

The sections below use a public dataset to answer these questions and demonstrates how statistical modelling can be used to plan direct services using online video.  

**2. Methodology**

The Pew Research Center's [Online Video 2013](http://www.pewinternet.org/2013/10/10/online-video-2013/), part of the Pew Internet and American Life project, is a useful data source in this context. 

The dataset comprises responses to questions about consumption of online video  included in an omnibus survey in 2013. As the responses were obtained from a probability sample of (English speaking) US adults conducted by landline and cell phone, and therefore inclusion in the sample frame wasn't predicated on internet access, we can use this dataset to directly estimate the fraction of the population watching online video. And thanks to the folks at Pew, the dataset and documentation is all available online for [download](http://www.pewresearch.org/data/download-datasets/). 

This analysis of the Online Video 2013 dataset is split into two parts:

1. *Exploratory analysis*: exploring associations between online video consumption and a range of demographic variables; 
2. *Statistical modelling*: fitting a logistic regression model to predict whether individuals watch online video based on demographic predictors.

The key variables used in this analysis are:

1. *Response*: online (Yes/No) and, as a subset of the online popualtion, watches online video (Yes/No);
2. *Predictors*: sex, race, age, education, income.

Those interested in the details of the analysis can go to the [R code](https://github.com/pete-rjames/online_video/blob/master/online_video.R) on Github. 

**3. Exploratory analysis**

```{r setup, include = FALSE}

# 1. Libraries
libs <- c("broom", "dplyr","foreign", "ggplot2", "knitr", "Hmisc", "survey")
lapply(libs, library, character.only = TRUE)
rm(libs)

# 2. Load data >> df_import

# mac: df_import <- read.spss("~/R/data/July-2013--Online-Video-(onmibus)/Omnibus_July_2013_Video_spss.sav", to.data.frame = TRUE)
# pc: 
df_import <- read.spss(".//July-2013--Online-Video-(onmibus)//Omnibus_July_2013_Video_spss.sav", to.data.frame = TRUE) # ignore warnings; 
df_import <- df_import %>% mutate(age = ifelse(age == 99, NA, age)) # convert 99 to NA for age

# 3. Add derived degmoraphic variables >> df_base

# 3.1 Lookup table for income midpoints

inc_midpoints <- data.frame(inc = as.factor(levels(df_import$inc)),
                            inc_midpoint = c(5000, 15000, 25000, 35000,45000,
                                             62500, 87500,125000, 150000,NA))

inc_midpoints$income_10k <- inc_midpoints$inc_midpoint/10000

# 3.2 Adding derived variables (see Omnibus_July_2013_Video_Crosstab.pdf for totals)

df_base <- df_import %>%
  data.frame() %>%
  mutate(white = factor((ifelse(hisp != "Yes" & race == "White", "White", "Not white")))) %>%
  mutate(black = factor((ifelse(hisp != "Yes" & race == "Black or African-American", "Black or African-American", "Not black or African-American")))) %>% 
  mutate(nonwhite = factor((ifelse(hisp == "Yes" | as.numeric(race) %in% 2:6, "Nonwhite", "White")))) %>%  
  mutate(race_group = relevel(nonwhite, "White")) %>%
  mutate(age_10yrs = age/10) %>%
  mutate(age_group = factor((ifelse(is.na(age), NA, cut2(age, cuts = c(30, 50, 65)))),
                       labels = c("18-29", "30-49", "50-64", "65+"))) %>% 
  mutate(education = factor((ifelse(as.numeric(educ2) < 4, 1,
                                ifelse(as.numeric(educ2) %in% 4:5, 2,
                                       ifelse(as.numeric(educ2) %in% 6:8, 3, NA)))),
                        labels = c("Hs or less", "Some coll", "Coll grad"))) %>% 
  mutate(income = factor((ifelse(as.numeric(inc) < 4, 1,
                               ifelse(as.numeric(inc) %in% 4:5, 2,
                                      ifelse(as.numeric(inc) == 6, 3,
                                             ifelse(as.numeric(inc) %in% 7:9, 4, NA))))),
                       labels = c("<$30K", "$30-49K", "$50-74K", "$75K+"))) %>%
  left_join(inc_midpoints[,c(1,3)], by = "inc") %>%
  mutate(iuser = ifelse(eminuse == "Yes" | intmob == "Yes", 1, 0)) %>%
  mutate(iuser_video = ifelse(act62 == "Yes" | act102 == "Yes" | act131 == "Yes", 1, 0)) %>%
  mutate(all_video = ifelse(is.na(iuser_video), 0, iuser_video))

# 4. Create svydesign object 

df <- df_base %>%
  select(psraid, sample, weight, iuser, iuser_video, all_video, sex, age, age_10yrs, age_group, race, race_group, inc, income, income_10k, educ2, education)

df_names <- data.frame(names(df))

des <- svydesign(id = ~ 1, strata = ~ sample, weights = ~ weight, data = df) 

rm(df_import, df_base, inc_midpoints)

```

Plot 1 below displays the proportion of US adults that are (a) online, and if online, (b) watching online video. 

```{r plot1, fig.width = 8, fig.height = 5, echo = FALSE}

iuser_mean <- svymean(~ iuser, design = des)
all_video_mean <- svymean(~ all_video, design = des)

df_summary <- data.frame(variable = c("online", "online video"),
                     mean = c(mean(iuser_mean), mean(all_video_mean)),
                     se = c(SE(iuser_mean), SE(all_video_mean)))

rm(iuser_mean, all_video_mean)

df_summary <- df_summary %>%
  mutate(lower = mean - (1.96*se)) %>%
  mutate(upper = mean + (1.96*se)) 

ggplot(df_summary, aes(x = variable, y = mean, fill = variable, label = round(mean,2))) +
  geom_bar(stat = "identity", width = 0.25) +
  geom_errorbar(aes(ymin = lower, ymax = upper), position = "dodge", color = "dark grey", size = 1, width = 0.25) +
  geom_text(nudge_y = -0.1) +
  ylim(0, 1) +
  xlab("") +
  ylab("proportion") +
  ggtitle("Proportion of US population online and watching online video, 2013")
```

Internet usage is an obvious and significant factor limiting the consumption of online video. To explore variation in internet access, Plot 2 below displays proportions of US adults that are online by all demographic variables in the dataset. Each variable is color coded with its constituent levels plotted separately. 

```{r plot2, fig.width = 12, fig.height = 6, echo = FALSE}

iuser_dyn <- function(x) {
  variable_name <- names(des$variables[(x)])
  temp <- svyby(~ iuser,
                as.formula(paste("~", variable_name)), 
                design = des, FUN = svymean)  
  colnames(temp)[1:2] <- c("variable_level", "proportion")
  temp %>%
    mutate(upper = proportion+(1.96*se)) %>%
    mutate(lower = proportion-(1.96*se)) %>%
    mutate(variable_name = variable_name)
}

iuser_list <- lapply(c(7, 10, 12, 14, 17), iuser_dyn) 
df_iuser <- do.call(rbind.data.frame, iuser_list)  

rm(iuser_dyn, iuser_list) 

iuser_plot <- ggplot(df_iuser, aes(x = variable_level, y = proportion, color = variable_name)) +
  geom_point(size = 4) +
  geom_pointrange(aes(ymin = lower, ymax = upper), size = 2) + 
  ylim(0,1) +
  xlab("") +
  ggtitle("Proportion of US population that is online, by demographic, 2013")

iuser_plot

```

Age, education and income all appear to be associated with internet usage. The proportion of adults online decreases in older age groups and increases with education and income level (though note the instability in the transition between income levels $30-49K and $50-74k). By contrast, sex and race appear less associated with internet usage.  

Plot 3 below displays the proportion of the *online population* (a subset of the main sample) that also watches online video for all demographic variables. 


```{r plot3, fig.width = 12, fig.height = 6, echo = FALSE} 

nrow(df[df$iuser == "0",]) == sum(is.na(df$iuser_video)) # defining NAs: non-online

iuser_video_dyn <- function(x) {
  variable_name <- names(des$variables[(x)])
  temp <- svyby(~ iuser_video,
                as.formula(paste("~", variable_name)), 
                design = des, FUN = svymean, na.rm = TRUE)  
  colnames(temp)[1:2] <- c("variable_level", "proportion")
  temp %>%
    mutate(upper = proportion+(1.96*se)) %>%
    mutate(lower = proportion-(1.96*se)) %>%
    mutate(variable_name = variable_name)
}

iuser_video_list <- lapply(c(7, 10, 12, 14, 17), iuser_video_dyn)
df_iuser_video <- do.call(rbind.data.frame, iuser_video_list) 

iuser_video_plot <- ggplot(df_iuser_video, aes(x = variable_level, y = proportion, color = variable_name)) +
  geom_point(size = 4) +
  geom_pointrange(aes(ymin = lower, ymax = upper), size = 2) + 
  ylim(0,1) +
  xlab("") +
  ggtitle("Proportion of US online population that watches video, by demographic, 2013")

iuser_video_plot

rm(iuser_video_dyn, iuser_video_list)
```

With some variations, we can see similar associations between demographic variables and consumption of online video as for internet usage in general. 

In this case, the proportion of adults watching online video decreases in older age groups, however the association seems more pronounced than for internet usage in general. By contrast, the positive association with educational and income levels seems less pronounced (and again, note the instability in the transition between income levels <$30k and $30-49K). Race also seems to have a possible association with watching online video, with a greater proportion of nonwhite respondents watching online video than white respondents. Sex seems unassociated with consumption of online video as it did for internet access in general.

These descriptive statistics suggests some of the demographic predictors that will be important in the statistical model developed below. They do not indicate the *independent* impact of any variable at this stage because the statistic for any single variable may "mask" the effect of associations with other variables that also have an impact on the response. 

**4. Statistical modelling**

*Introduction*

This section develops a statistical model for predicting consumption of online video based on demographic variables. 

The model is constructed to predict whether or not an individiual watches online video (Yes/No) and uses the full weighted sample as its base value. This gives a more directly applicable model than would be achieved by separately modelling (a) whether an individual is online, (b) and if so, whether they watch online video. And as we have seen above, there are similar (if not identical) associations between demographic predictors and both of these outcomes. 

As the response variable in the model is binary, a logistic regression model is selected to predict the probability of watching online video (0 => *Pr* <= 1). The predicted outcome (0 | 1) is based on rounding the probability to the nearest integer. 

*Stage 1: selecting predictors*

Prior to developing the multivariate model, we build a series of single-predictor models using each demographic predictor in turn. By identifying predictors where the sign of the coefficient has a high probability of arising through random variation, we can identify predictors that are clearly unrelated to the outcome (even if the effects of other variables are masked) and exclude them from the multivariate model. The coefficients for single-predictor models are shown in Table 1 below. 

```{r table1, echo = FALSE, warning= FALSE}

uni_mod <- function(x) {
  predictor <- names(des$variables[(x)])
  fit <- svyglm(as.formula(paste("all_video ~", predictor)),
                design = des, family = quasibinomial)
  fit <- tidy(fit) %>%
    filter(term != "(Intercept)")
  return(fit)
} 

uni_fit_list <- lapply(c(7,9,12,15,17), uni_mod)
df_uni_fit <- do.call(rbind.data.frame, uni_fit_list)

df_uni_fit <- df_uni_fit %>%
  rowwise() %>%
  mutate(term = gsub("([[:lower:]])([[:upper:]])", "\\1 \\2", term)) %>%
  mutate_each(funs(round(.,3)), - term)  

kable(df_uni_fit,
      format = "html", output = F, align = c("l", "c", "c", "c"), escape=F,
      table.attr="class='table table-striped table-hover'")

rm(uni_mod, uni_fit_list) 

```

As strongly suggested by the exploratory analysis, the single-predictor model suggests that `sex` is very unlikely to be a significant predictor and should not be entered into the multivariate model. All other variables can be entered into the multivariate model as the confidence intervals for coefficients do not cross the zero threshold. 

*Stage 2: training the model*

As the number of observations is reasonably large, and the range of demographic predictors reasonably constrained, we begin by building a model using all remaining demographic variables, `m1`. This model is fit to a randomly selected training dataset accounting for two-thirds of the full dataset. This first iteration of the model suggests that `race` is not a significant predictor. The second iteration `m2` excludes race and therefore constrains the predictors to `age`, `education` and `income`. This model has coefficients that are all statistically significant, and reducing the number of variables entered into the model only causes a negligible increase in the residual standard deviation. The coefficients for the two models are summarized in the table below.


```{r table2, echo = FALSE}

set.seed(1000) 

df_mod <- df %>%
  select(psraid, weight, sample, all_video, age_10yrs, race_group, education, income_10k) %>%
  filter(complete.cases(psraid, weight, sample, all_video, age_10yrs, race_group, education, income_10k))

df_train <- df_mod %>%
  mutate(split = rbinom(n = n(), size = 1, prob = (2/3))) %>%
  filter(split == 1)    

df_test <- anti_join(df_mod, df_train, by = "psraid") 

des_train <- svydesign(id = ~ 1, strata = ~ sample, weights = ~ weight, data = df_train) 

# 6.2.2 Model 1

fit_1 <- svyglm(all_video ~ age_10yrs + race_group + education + income_10k,
               design = des_train,
               family = quasibinomial)

df_fit_1 <- fit_1 %>%
  tidy() %>%
  mutate(lower = estimate - 1.96*(std.error)) %>%
  mutate(upper = estimate + 1.96*(std.error)) %>%
  mutate_each(funs(round(.,3)), - term)  


# 6.2.3 Model 2

fit_2 <- svyglm(all_video ~ age_10yrs + education + income_10k,
              design = des_train,
              family = quasibinomial)

df_fit_2 <- fit_2 %>%
  tidy() %>%
  mutate(lower = estimate - 1.96*(std.error)) %>%
  mutate(upper = estimate + 1.96*(std.error)) %>%
  mutate_each(funs(round(.,3)), - term) 


fit_table <- left_join(df_fit_1[,c(1,2,5)], df_fit_2[,c(1,2,5)], by = "term") %>%
  mutate(term = gsub("([[:lower:]])([[:upper:]])", "\\1 \\2", term))
  colnames(fit_table)[2:5] <- c("estimate (m1)", "p.value (m1)", 
                              "estimate (m2)", "p.value (m2)")  
  
kable(fit_table,
      format = "html", output = F, align = c("l", "c", "c", "c", "c"), escape=F,
      table.attr="class='table table-striped table-hover'")

```

*Stage 3: testing the model*

```{r model_error, echo = FALSE}

df_test$mean_prob <- svymean(~ all_video, design = des_train, na.rm = TRUE)
df_test$mean_outcome <-  ifelse(df_test$mean_prob > 0.5, 1, 0)
df_test$mean_error <- ifelse(df_test$mean_outcome != df_test$all_video, 1, 0)

df_test$mod_prob <- predict(fit_2, newdata = df_test, type = "response")
df_test$mod_outcome <- ifelse(df_test$mod_prob > 0.5, 1, 0)
df_test$mod_error <- ifelse(df_test$mod_outcome != df_test$all_video, 1, 0)

null_error <- round(mean(na.omit(df_test$mean_error)),2)
model_error <- round(mean(na.omit(df_test$mod_error)),2)

```

The predictive accuracy of the model can be assessed by comparing its performance against a null model based on the weighted mean of the training dataset. The two models are compared using a test dataset that comprises the remaining one third of observations in the original dataset. 

The error rate of the null model is **`r null_error`**, reducing to **`r model_error`** for the fitted model. This substantial decrease in the error rate indicates that the fitted model generalizes effectively to a new set of observations that did not inform the development of the model. 

**5. Using the model**

The statistical model corresponds to some of observations made during the exploratory analysis: the probability of watching online video decreases with age and increases with educational level and income. Using the model, we can now extend these observations to quantify the impact of variation in each predictor on the outcome.

As an example, a service provider may inform its decisions on investing in online video based on the likelihood that service users already engage with the medium. In this context, it may be useful to use a threshold for decision making, such as that 50% of a segment watches online video. We can use the logistic regression model to compute this probability for specific segements based on demographics. 

Take the example of a social service provider primarily working with low-income, working-age adults. On the one hand, the negative coefficient for age may suggest that the medium is appropriate for a working age audience; on the other hand, the positive coefficients for income (and educational level) may suggest caution in investing in online video. How to balance these two competing considerations?

Using the regression model, we can compute estimated probabilities for a hypothetical population of adults. As a simple example, we construct a population that is all non-college educated, split into 5 subgroups with the incomes corresponding to the bottom five income deciles, and with a range of ages within each subgroup from 18 to 80. Plot 4 below shows how the modelled probability of watching online video declines with age for 5 bottom income deciles. 

```{r plot4, fig.width = 8, fig.height = 5, echo = FALSE}

age_inc_sim <- function(x) { 
  temp <- data.frame(age_10yrs = seq.int(from = 1.8, to = 8.0, by = 0.1),   
                            education = "Hs or less",
                            income_10k = svyquantile(~ income_10k, design = des, quantiles = (x), na.rm = TRUE)[1],
                            decile = as.factor(x))
  return(temp)
}  

quantiles <- seq(from = 0.1, to = 0.5, by = 0.1)
age_sim <- lapply(quantiles, age_inc_sim)
df_age <- do.call(rbind.data.frame, age_sim)
df_age$prob <- predict.glm(fit_2, newdata = df_age, type = "response") 

ggplot(df_age, aes(x = (age_10yrs*10), y = prob, color = decile)) +
  geom_freqpoly(stat = "identity", size = 1) +
  ylim(0,1) +
  ylab("Probability") + 
  xlab("Age") +
  geom_hline(yintercept = 0.5, linetype = 2, color = "dark grey") + 
  ggtitle("Probability of watching online video by age, for 5 income deciles")

```

Using this plot, we can predict that the threshold value of 50% is exceeded for all of the bottom five income deciles up until around age 40 years. The curve then declines such that by around age 60 years the probability has decreased to 25% for all of the bottom five income deciles. Our expectations for reaching different audience segements can therefore be quantitatively defined as part of the service planning process. 

**Acknowledgements**

Data: Pew Research Center  
R: R core development team; packages contributed by Frank E Harrell Jr, Thomas Lumley, David Robinson, Hadley Wickham and Yihui Xie.
